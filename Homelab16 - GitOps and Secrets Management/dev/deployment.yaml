apiVersion: v1
kind: Secret                # Secret Object Type in Kubernetes per https://kubernetes.io/docs/concepts/configuration/secret/
metadata:
  name: demo-secret         # Required: unique identifier
  namespace: demo-dev       # Optional: logical grouping
  annotations:              # Specify where the ArgoCD Vault Plugin should look for for vault values: https://argocd-vault-plugin.readthedocs.io/en/stable/howitworks/
    avp.kubernetes.io/path: "secret/data/demo-dev"
type: Opaque                # This is abitrary user-defined data -- usually used for Secret Object types https://kubernetes.io/docs/concepts/configuration/secret/
stringData:
  DB_PASS: <DB_PASSWORD>    # The <DB_PASSWORD> is the key for the actual secret being stored in the HashiCorp Vault
---                         # Document separator - multiple resources in one file
apiVersion: apps/v1
kind: Deployment            # Deployment manages and maintains a set of identical pods
metadata:
  name: demo-app            # Unique identifier for this Deployment
  namespace: demo-dev       # Namespace where this Deployment will be created
spec:
  replicas: 1
  selector:                 # The 'selector' matches Pods by labels so this Deployment owns and manages them
    matchLabels:
      app: demo-app         # In this case we have the "demo-app" being the label
  template:                 # Create the metadata labels for the Pods that will be created
    metadata:
      labels:
        app: demo-app       # In this case we have the "demo-app" being the label
    spec:                   # Pod specification
      containers:
      - name: deployment
        image: nginx:latest # Docker image to use for this container (the latest image)
        ports:
        - containerPort: 80 # Port the container listens on (nginx default HTTP port)
        env:                # Environment variables to inject into the container
        - name: DB_PASS     # Environment variable name inside the container
          valueFrom:        # Get value from an external source instead of hardcoding
            secretKeyRef:   # Pull value from the demo-secret Secret object
              name: demo-secret  # Name of the Secret to reference
              key: DB_PASS       # Key within that Secret to extract